{ pkgs, lib, ... }:
{
  boot = {
    tmp.cleanOnBoot = true;
    swraid.enable = lib.mkDefault false;
    loader = {
      timeout = lib.mkDefault 2;
      generationsDir.copyKernels = true;
      efi.canTouchEfiVariables = true;
      systemd-boot = {
        enable = true;
        configurationLimit = 5;
        consoleMode = lib.mkDefault "max";
        editor = false;
      };
    };

    initrd = {
      # Verbosity of the initrd
      # disabling verbosity removes only the mandatory messages generated by the NixOS
      verbose = false;
      systemd = {
        # enable systemd in initrd
        enable = true;
        strip = true;
      };
      kernelModules = [
        "ahci"
        "xhci_pci"
        "nvme"
        "usbhid"
        "tpm"
      ];
    };
    kernelPackages = pkgs.linuxPackages_xanmod_latest; # pkgs.linuxPackages_xanmod_latest, pkgs.linuxPackages_zen, pkgs.linuxPackages_lqx, linuxPackages_latest
    kernelParams = [
      # https://en.wikipedia.org/wiki/Kernel_page-table_isolation
      # auto means kernel will automatically decide the pti state
      "pti=auto" # on | off

      # CPU idle behaviour
      #  poll: slightly improve performance at cost of a hotter system (not recommended)
      #  halt: halt is forced to be used for CPU idle
      #  nomwait: Disable mwait for CPU C-states
      "idle=nomwait" # poll | halt | nomwait

      # disable usb autosuspend
      "usbcore.autosuspend=-1"

      # allows systemd to set and save the backlight state
      "acpi_backlight=native" # none | vendor | video | native

      # disable displaying of the built-in Linux logo
      "logo.nologo"

      "nowatchdog"
      "modprobe.blacklist=sp5100_tco"
    ];
  };
}
