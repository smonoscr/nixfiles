branches:
  - main

preset: "conventionalcommits"

tagFormat: "${version}"

verifyConditions:
  - "@semantic-release/changelog"
  - "@semantic-release/git"

analyzeCommits:
  - path: "@semantic-release/commit-analyzer"
    preset: "conventionalcommits"
    releaseRules:
      - type: milestone # a milestone release marking a huge step forward in development
        release: major
      - type: breaking # changes that break something makes something incompatible to earlier version
        release: major
      - type: build # changes that affect the build system or external dependencies
        release: patch
      - type: chore # other changes that don't modify src or test files
        release: false
      - type: ci # changes to our ci configuration files and scripts
        release: false
      - type: docs # documentation only changes
        release: false
      - type: feat # a new feature
        release: minor
      - type: fix # a bug fix
        release: patch
      - type: perf # a code change that improves performance
        release: patch
      - type: refactor # a code change that neither fixes a bug nor adds a feature
        release: patch
      - type: revert # reverts a previous commit
        release: patch
      - type: style # changes that do not affect the meaning of the code
        release: false
      - type: test # adding missing tests or correcting existing tests
        release: false
      - type: improv # a change which improves an already existing feature or aspect
        release: patch
      - type: deps # dependency changes/updates/downgrades
        release: false

generateNotes:
  - path: "@semantic-release/release-notes-generator"
    preset: "conventionalcommits"
    writerOpts:
      groupBy: "type"
      commitGroupsSort: "title"
      commitsSort: "header"
    linkCompare: true
    linkReferences: true
    presetConfig:
      types:
        - type: "milestone"
          section: "âœ¨ milestone"
          hidden: false
        - type: "breaking"
          section: "ğŸ§¨ breaking changes!"
          hidden: false
        - type: "build"
          section: "ğŸ¦Š ci/cd"
          hidden: false
        - type: "chore"
          section: "ğŸ“¦ other"
          hidden: false
        - type: "ci"
          section: "ğŸ¦Š ci/cd"
          hidden: false
        - type: "docs"
          section: "ğŸ“” docs"
          hidden: false
        - type: "feat"
          section: "ğŸš€ features"
          hidden: false
        - type: "fix"
          section: "ğŸ›  fixes"
          hidden: false
        - type: "perf"
          section: "â© performance"
          hidden: false
        - type: "refactor"
          section: "âœ‚ï¸ refactor"
          hidden: false
        - type: "revert"
          section: "ğŸ‘€ reverts"
          hidden: false
        - type: "style"
          section: "ğŸ’ˆ style"
          hidden: false
        - type: "test"
          section: "ğŸ§ª tests"
          hidden: false
        - type: "improv"
          section: "ğŸ’ improvements"
          hidden: false
        - type: "deps"
          section: "ğŸ”© dependencies"
          hidden: false

prepare:
  - path: "@semantic-release/changelog"
  - path: "@semantic-release/git"
    message: "chore(release): ${nextRelease.version} [skip ci]"
    assets: ["CHANGELOG.md"]

publish:
  - path: "@semantic-release/exec"
    cmd: |
      # create release via forgejo api (if FORGEJO_TOKEN is set)
      if [ -n "$FORGEJO_TOKEN" ]; then
        curl -X POST \
          -H "Authorization: token $FORGEJO_TOKEN" \
          -H "Content-Type: application/json" \
          "https://codeberg.org/api/v1/repos/${GITHUB_REPOSITORY}/releases" \
          -d "{
            \"tag_name\": \"${nextRelease.version}\",
            \"name\": \"${nextRelease.version}\",
            \"body\": $(echo "${nextRelease.notes}" | jq -Rs .),
            \"draft\": false,
            \"prerelease\": false
          }"
      fi

ci: true
success: false
fail: false
